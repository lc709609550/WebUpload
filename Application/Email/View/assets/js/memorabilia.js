/** * Created by BHZXZbaibing on 2017/5/18. */var selectVal,ops;$(function(){    var heights = $('#sidebar').height() - 105;    var jqTableH = heights - $('.headers').outerHeight(true);    $('#memorabilia_container').height(jqTableH);    // select_onchange();    memorabilia_time_axis_data();    $("#memorabilia_container").mCustomScrollbar({        live:true,        theme:"minimal"    });});//时间轴function memorabilia_time_axis(){    var mydate = new Date();    var str = mydate.getDate();    $(".memorabilia_main .year>h2>a").bind('click',function (e) {        e.preventDefault();        //$(this).parents(".year").toggleClass("closes");        if($(this).parents(".year").attr('onOff') == 'on'){            $(this).parents(".year").removeClass("closes");            $(this).parents(".year").attr('onOff','off');        }else if($(this).parents(".year").attr('onOff') == 'off'){            $(this).parents(".year").addClass("closes");            $(this).parents(".year").attr('onOff','on');        }        $(this).parents(".year").siblings().attr('onOff','on');        $(this).parents(".year").siblings().addClass("closes");    });    $(".memorabilia_main .year>h2>a").eq(0).trigger('click');}//时间轴function memorabilia_time_axis_data(selectVal,dateVal){    var year_html = '';    $.ajax({        url:"http://"+location.host+"/project/memorabilia/get_project_memorabilia?"+new Date(),        type:"POST",        async:false,        data:{            'p_id':selectVal,            'start_time':dateVal        },        dataType:"json",        success:function (result) {            $('.memorabilia_main').html('');            $.each(result,function(k,v){                var month_html = '';                var month_time = '';                $.each(v,function(m,n){                    $.each(n,function (key,val) {                        if(val.classification == null){                            val.classification = '';                        }                        if(val.type == 1){                            month_html +='<p class="intro" type_s="'+val.type+'">' +                                '<span>' +                                '<em>' + val.classification + '</em>&nbsp;&nbsp;' +                                '<em>' + val.oper + '</em>&nbsp;&nbsp;' +                                '<em>' + val.mem_name + '</em>' +                                '</span> ' +                                '<a href="javascript:void(0)" pId="'+val.p_id+'"  times="'+val.start_time+'" equipments="' + val.classification+' " faults="'+val.mem_name+'">查看详情</a>' +                                '</p>'                        }else if(val.type == null){                            if(val.true_name == null){                                val.true_name = '';                            }                            month_html +='<p class="intro" type_s="'+val.type+'">' +                                '<span>' +                                '<em>' + val.true_name + '</em>&nbsp;&nbsp;' +                                '<em>' + val.oper + '</em>&nbsp;&nbsp;' +                                '<em>' + val.classification + '</em>&nbsp;&nbsp;' +                                '<em>' + val.mem_name + '</em>' +                                '</span> ' +                                '<a href="javascript:void(0)" pId="'+val.p_id+'" jId="'+val.j_id+'" tId = "'+val.t_id+'" fId = "'+val.f_id+'">查看詳情</a>' +                                '</p>' ;                        }                    })                    month_time += '<li class="cls"> ' +                        '<img src="./assets/img/log/u4012.png">' +                        '<p class="date">'+m+'</p>' +                        '<div class="clear" style="float: left;width: 80%;margin-top: 8px;">' +                              month_html+                        '</div>' +                        '</li> '                    month_html = ''                })                //年份                year_html = '<div class="year" onOff="on">' +                    ' <h2><a href="#">'+k+'<i></i></a>' +                    '<img src="./assets/img/log/u4010.png">' +                    '</h2>' +                    '<div class="list">' +                    '<ul> '+                    month_time+                    '</ul> ' +                    '</div> ' +                    '</div>';                $('.memorabilia_main').append(year_html);            })            memorabilia_details();            //时间轴            memorabilia_time_axis();        }    });}//详情function memorabilia_details(){  $('.intro a').unbind().bind('click',function(){      if($(this).parents('p').attr('type_s') == 'null'){          $('#nav-accordion>li #project_information').find('a').click();          onOf = true;          pId = $(this).attr('pId');          pId == "null" ? pId = '' : pId;          jId = $(this).attr('jId');          jId == "null" ? jId = '' : jId;          tId = $(this).attr('tId');          tId == "null" ? tId = '' : tId;      }else if($(this).parents('p').attr('type_s') == 1){          $('#nav-accordion>li #fault_case_library').find('a').click();          pId = $(this).attr('pId');          pId == "null" ? pId = '' : pId;          timeA =  $(this).attr('times');          timeA == "null" ? timeA = '' : timeA;          equipmentName = $(this).attr('equipments');          equipmentName == "null" ? equipmentName = '' : equipmentName;          faultName = $(this).attr('faults');          faultName == "null" ? faultName = '' : faultName;      }  });    $('.intro span').unbind().bind('click',function(){        if($(this).parents('p').attr('type_s') == 'null'){            $('#nav-accordion>li #project_information').find('a').click();            onOf = true;            pId = $(this).siblings('a').attr('pId');            pId == "null" ? pId = '' : pId;            jId = $(this).siblings('a').attr('jId');            jId == "null" ? jId = '' : jId;            tId = $(this).siblings('a').attr('tId');            tId == "null" ? tId = '' : tId;        }else if($(this).parents('p').attr('type_s') == 1){            $('#nav-accordion>li #fault_case_library').find('a').click();            pId = $(this).siblings('a').attr('pId');            pId == "null" ? pId = '' : pId;            timeA =  $(this).siblings('a').attr('times');            timeA == "null" ? timeA = '' : timeA;            equipmentName = $(this).siblings('a').attr('equipments');            equipmentName == "null" ? equipmentName = '' : equipmentName;            faultName = $(this).siblings('a').attr('faults');            faultName == "null" ? faultName = '' : faultName;        }    })}//项目名称筛选function select_onchange(){    /*$('#memorabilia_project').bind('change',function(){        selectVal = $('#memorabilia_project').val();        ops =  $('#memorabilia_project option[value = '+selectVal+']').attr('parentid');        memorabilia_time_axis_data(selectVal,'');    });    $('#memorabilia_project').trigger('change');*/}$(document).ready(function () {    $("#datefix").jeDate({        fixedCell:"refix",        isClear:false,        isok:false,        initAddVal:{MM:"+3",DD:"+2"},        minDate:"1900-01-01 00:00:00",              //最小日期        maxDate:"2099-12-31 23:59:59",              //最大日期        format:"YYYY-MM-DD",        todayHighlight: true, //当为true的时候高亮        zIndex:3000,        choosefun:function (elem,val,date) {            memorabilia_time_axis_data(selectVal,val);        },        okfun:function (elem,val,date) {        }    })});